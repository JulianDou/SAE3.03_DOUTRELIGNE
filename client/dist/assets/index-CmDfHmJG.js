(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const P=await fetch("src/ui/header/template.html"),B=await P.text();let k={};k.render=function(){return B};const H=await fetch("src/ui/basic-counter/template.html"),F=await H.text();let y={};y.render=function(e,t){let r=F;return r=r.replace("{{type}}",t),r=r.replace("{{count}}",e),r};const M=await fetch("src/ui/podium/template.html"),$=await M.text(),D=await fetch("src/ui/podium/templatebase.html"),O=await D.text();let L={};L.render=function(e){let t=O,r=$;for(let a=0;a<e.length;a++){let n=e[a].text,o=e[a].values,i=e[a].backgroundColor;r=r.replace(`{{text${a+1}}}`,n),r=r.replace(`{{values${a+1}}}`,o),r=r.replaceAll(`{{backgroundColor${a+1}}}`,i)}return t=t.replace("{{podium}}",r),t};let C={};C.render=function(e,t,r,a,n){let o=[];if(t=="single")o=[{values:e.values}],o[0].text="Total des ventes";else if(t=="multiple"){for(let u=0;u<e.values.length;u++)o.push({values:e.values[u]});o[4]={values:e.values[4],"line-color":"#94bd54",marker:{"background-color":"#94bd54"},text:"Légumes"},o[3]={values:e.values[3],"line-color":"#6fd6be",marker:{"background-color":"#6fd6be"},text:"Produits Laitiers"},o[2]={values:e.values[2],"line-color":"#ec857f",marker:{"background-color":"#ec857f"},text:"Viande"},o[1]={values:e.values[1],"line-color":"#28ae71",marker:{"background-color":"#28ae71"},text:"Fruits"},o[0]={values:e.values[0],"line-color":"#da9660",marker:{"background-color":"#da9660"},text:"Boulangerie"}}let i={type:"line",backgroundColor:"#fff",title:{text:a,align:"center",fontColor:"#000",fontFamily:"Open Sans",fontSize:"25px"},subtitle:{text:n,align:"center",fontColor:"#444",fontFamily:"Open Sans",fontSize:"12px"},scaleX:{labels:e.names},series:o};t=="multiple"&&(i.legend={}),zingchart.render({id:r,data:i,height:"100%",width:"100%"})};let v=function(e,t){let r=e;for(let a in t)r=r.replaceAll(new RegExp("{{"+a+"}}","g"),t[a]);return r};const E=await fetch("src/ui/lowstock/template.html"),V=await E.text(),I=await fetch("src/ui/lowstock/templatebase.html"),z=await I.text();let h={};h.render=function(e){let t=z,r=V,a,n;for(let o of e)o.color=o.category.toLowerCase(),n=v(r,o),a+=n;return t=t.replace("{{products}}",a),t};h.color=function(){let e=document.querySelectorAll("#product-stock");for(let t of e)parseInt(t.innerText)==0?t.style.backgroundColor="#111":parseInt(t.innerText)<=3?t.style.backgroundColor="#991d02":parseInt(t.innerText)<=6?t.style.backgroundColor="#b06e0b":parseInt(t.innerText)<=10?t.style.backgroundColor="#8f8803":t.style.backgroundColor="#337832"};const A=await fetch("src/ui/listelement/template.html"),_=await A.text();let w={};w.render=function(e){let t=_,r="";for(let a of e)t=_,a.category?(a.color=a.category.toLowerCase(),a.name=a.product_name,a.quantity?a.quantity=a.quantity+"x":a.quantity="(ID"+a.id+")"):a.firs_name?(a.color="white",a.name=a.firs_name+" "+a.last_name,a.quantity="(ID"+a.id+")"):(a.name=a.month,a.id=a.name,a.color="white",a.quantity=""),t=v(t,a),r+=t;return r};const G=await fetch("src/ui/customer/template.html"),R=await G.text();let x={};x.render=function(e,t){let r=R;r=v(r,e);let a={dairies:[],meat:[],fruits:[],vegetables:[],bakery:[]};for(let n of t)n.category==="Dairy"?a.dairies.push(n):n.category==="Meat"?a.meat.push(n):n.category==="Fruits"?a.fruits.push(n):n.category==="Vegetables"?a.vegetables.push(n):n.category==="Bakery"&&a.bakery.push(n);for(let n in a){let o=w.render(a[n]);r=r.replace(`{{${n}}}`,o)}return r};let q={};q.render=function(e,t){let r={dairies:0,meat:0,fruits:0,vegetables:0,bakery:0};for(let o of e)o.category=="Dairy"?r.dairies+=o.quantity:o.category=="Meat"?r.meat+=o.quantity:o.category=="Fruits"?r.fruits+=o.quantity:o.category=="Vegetables"?r.vegetables+=o.quantity:o.category=="Bakery"&&(r.bakery+=o.quantity);let n={type:"bar",series:[{values:[r.dairies],text:"Produits Laitiers",backgroundColor:"#6fd6be"},{values:[r.meat],text:"Viande",backgroundColor:"#ec857f"},{values:[r.fruits],text:"Fruits",backgroundColor:"#28ae71"},{values:[r.vegetables],text:"Légumes",backgroundColor:"#94bd54"},{values:[r.bakery],text:"Boulangerie",backgroundColor:"#da9660"}],legend:{},scaleX:{labels:[""]}};zingchart.render({id:t,data:n,height:"100%",width:"100%"})};let S={};S.render=function(e,t){let r={dairies:0,meat:0,fruits:0,vegetables:0,bakery:0};for(let o of e)o.category=="Dairy"?r.dairies+=o.quantity:o.category=="Meat"?r.meat+=o.quantity:o.category=="Fruits"?r.fruits+=o.quantity:o.category=="Vegetables"?r.vegetables+=o.quantity:o.category=="Bakery"&&(r.bakery+=o.quantity);let n={type:"pie",series:[{values:[r.dairies],text:"Produits Laitiers",backgroundColor:"#6fd6be"},{values:[r.meat],text:"Viande",backgroundColor:"#ec857f"},{values:[r.fruits],text:"Fruits",backgroundColor:"#28ae71"},{values:[r.vegetables],text:"Légumes",backgroundColor:"#94bd54"},{values:[r.bakery],text:"Boulangerie",backgroundColor:"#da9660"}],legend:{}};zingchart.render({id:t,data:n,height:"100%",width:"100%"})};let T={};T.render=function(e,t){let r=[],a=[],n=[],o=0;for(let g of e){a.push(g.month);for(let c of g.countries)c.name.length>4&&(c.name=="United Kingdom"?c.name="U.K.":c.name=c.name.substring(0,4)+"."),n.includes(c.name)?r[n.indexOf(c.name)].values.push(c.total_quantity):(n.push(c.name),r.push({values:[c.total_quantity],reference:"chart-max"})),c.total_quantity>o&&(o=c.total_quantity)}let i=["#235ac4","#6fe2c8","#ffb900","#ff3200"],u=["%v >= 0 && %v < "+o/4,"%v >= "+o/4+" && %v < "+o/4*2,"%v >= "+o/4*2+" && %v < "+o/4*3,"%v >= "+o/4*3],p={plot:{rules:[{backgroundColor:i[0],rule:u[0]},{backgroundColor:i[1],rule:u[1]},{backgroundColor:i[2],rule:u[2]},{backgroundColor:i[3],rule:u[3]}]},title:{text:"Articles vendus par pays, par mois",align:"center",fontColor:"#000",fontFamily:"Open Sans",fontSize:"25px"},subtitle:{text:"Sur les 12 derniers mois",align:"center",fontColor:"#444",fontFamily:"Open Sans",fontSize:"12px"},scaleY:{values:n},scaleX:{values:a},type:"heatmap",series:r};zingchart.render({id:t,data:p,height:"100%",width:"100%"})};let j="https://mmi.unilim.fr/~doutreligne1/SAE303/api/",f=async function(e){let t={method:"GET"};try{var r=await fetch(j+e,t)}catch(n){return console.error("Echec de la requête : "+n),!1}return r.status!=200?(console.error("Erreur de requête : "+r.status),!1):await r.json()},d={};d.getOrderByStatus=async function(e){let t=await f(`commandes?status=${e}`);return t=t.count,t};d.getTotal=async function(e){let t=await f("commandes?stat=total&sorted="+e);if(t.reverse(),e=="true"){let r=[],a=0;for(;a<t.length;)r.push(t[a].month),a+=5;let n=[],o=[];for(let i=0;i<t.length;i++){let u=t[i].product,p=parseFloat(t[i].total_value);o[u]||(o[u]=[]),o[u].push(p)}for(let i in o)n.push(o[i]);t={names:r,values:n}}else if(e=="false"){let r=[],a=[];for(let n of t)n.total_value=parseFloat(n.total_value),r.push(n.month),a.push(n.total_value);t={names:r,values:a}}return t};d.getByCustomer=async function(e){return await f(`commandes?customer=${e}`)};d.getWorld=async function(){let e=await f("commandes?stat=world"),t={},r={};for(let a of e){let n=a.order_date.slice(0,-3);r[n]||(r[n]=[]),r[n].push(a)}t=[];for(let a in r){let n=r[a],o=[];for(let i of n){let u=i.country,p=parseInt(i.total_quantity),g=o.find(c=>c.name===u);g?g.total_quantity+=p:o.push({name:u,total_quantity:p})}t.push({month:a,countries:o})}return t};let m={};m.getTop3Products=async function(){let e=await f("produits?stat=top3"),t=[];for(let r of e){r.quantity_sold=parseInt(r.quantity_sold);let a=r.category.toLowerCase(),n={text:r.product_name,values:r.quantity_sold,backgroundColor:a};t.push(n)}return t};m.getLowStock=async function(){return await f("produits?stat=lowstock")};m.getProduct=async function(e){let t=await f("produits?id="+e),r=[],a=[];for(let o of t.data)o.total_value=parseFloat(o.total_value),r.push(o.month),a.push(o.total_value);return{name:t.name.product_name,data:{names:r,values:a}}};m.getProducts=async function(){return await f("produits")};let b={};b.getCustomers=async function(){return await f("clients")};b.getCustomer=async function(e){return await f("clients?id="+e)};let s={};s.init=async function(){l.init(),s.loadCounters(),s.loadTop3(),s.loadGraph(),s.loadLowStock(),s.loadProduct(1),s.loadProductList(),s.loadCustomer(1),s.loadCustomerList(),s.loadHeatmap()};s.loadCounters=async function(){let e=await d.getOrderByStatus("Pending"),t=await d.getOrderByStatus("Shipped"),r=await d.getOrderByStatus("Delivered");l.renderBasicCounter(e,t,r)};s.loadTop3=async function(){let e=await m.getTop3Products();l.renderTop3(e)};s.loadGraph=async function(){let e=await d.getTotal("false");l.renderGraph(e,"single"),document.querySelector("#sales-graph-btns").addEventListener("click",s.handler__graphBtns)};s.loadLowStock=async function(){let e=await m.getLowStock();l.renderLowStock(e)};s.loadProduct=async function(e){let t=await m.getProduct(e);l.renderProduct(t)};s.loadProductList=async function(){let e=await m.getProducts();l.renderProductList(e),l.productlist.addEventListener("click",s.handler__productList)};s.loadCustomer=async function(e){let t=await b.getCustomer(e),r=await d.getByCustomer(e);l.renderCustomer(t,r),document.querySelector("#client-product-list").addEventListener("click",s.handler__productList),document.querySelector("#customer-switch").addEventListener("click",s.handler__switchCustomerMode)};s.loadCustomerList=async function(){let e=await b.getCustomers();l.renderCustomersList(e),l.customerslist.addEventListener("click",s.handler__customerList)};s.loadCustomerBars=async function(e){let t=await d.getByCustomer(e);l.renderCustomerBars(t)};s.loadCustomerPie=async function(e){let t=await d.getByCustomer(e);l.renderCustomerPie(t)};s.loadHeatmap=async function(){let e=await d.getWorld();l.renderHeatmap(e)};s.handler__graphBtns=async function(e){let t=e.target.dataset.mode;if(t=="single"){let r=await d.getTotal("false");l.renderGraph(r,"single")}else if(t=="multiple"){let r=await d.getTotal("true");l.renderGraph(r,"multiple")}};s.handler__productList=async function(e){if(e.target.id=="list-elt"){let t=e.target.dataset.id;s.loadProduct(t)}};s.handler__customerList=async function(e){if(e.target.id=="list-elt"){let t=e.target.dataset.id;s.loadCustomer(t)}};s.handler__sunburstList=async function(e){if(e.target.id=="list-elt"){let t=e.target.dataset.id;s.loadSunburst(t)}};s.handler__switchCustomerMode=async function(e){e.target.dataset.mode=="detail"?(e.target.dataset.mode="barres",e.target.innerHTML="Vue en secteurs",s.loadCustomerBars(e.target.dataset.id)):e.target.dataset.mode=="barres"?(e.target.dataset.mode="pie",e.target.innerHTML="Vue en détail",s.loadCustomerPie(e.target.dataset.id)):(e.target.dataset.mode="detail",e.target.innerHTML="Vue en barres",s.loadCustomer(e.target.dataset.id))};let l={header:document.querySelector("#header"),basicCounters:document.querySelector("#basic-counters"),top3:document.querySelector("#top3-products"),lowStock:document.querySelector("#lowstock-products"),productlist:document.querySelector("#product-select"),customerslist:document.querySelector("#customer-select"),customerinfo:document.querySelector("#client-info"),customerswitch:document.querySelector("#customer-switch")};l.init=function(){l.renderHeader()};l.renderHeader=function(){l.header.innerHTML=k.render()};l.renderBasicCounter=function(e,t,r){l.basicCounters.innerHTML=y.render(e,"En Attente"),l.basicCounters.innerHTML+=y.render(t,"En Cours"),l.basicCounters.innerHTML+=y.render(r,"Livrées")};l.renderTop3=function(e){l.top3.innerHTML=L.render(e)};l.renderGraph=function(e,t){C.render(e,t,"sales-graph","Total du revenu des ventes","Ces 6 derniers mois")};l.renderLowStock=function(e){l.lowStock.innerHTML=h.render(e),l.lowStock.children[1].firstChild.remove(),h.color()};l.renderProduct=function(e){C.render(e.data,"single","product-sales","Revenu des ventes pour le produit :",e.name)};l.renderProductList=function(e){l.productlist.innerHTML=w.render(e)};l.renderCustomer=function(e,t){l.customerinfo.innerHTML=x.render(e,t)};l.renderCustomersList=function(e){l.customerslist.innerHTML=w.render(e)};l.renderCustomerBars=function(e){document.querySelector("#client-product-list").innerHTML="",q.render(e,"client-product-list")};l.renderCustomerPie=function(e){document.querySelector("#client-product-list").innerHTML="",S.render(e,"client-product-list")};l.renderHeatmap=function(e){T.render(e,"heatmap")};s.init();
